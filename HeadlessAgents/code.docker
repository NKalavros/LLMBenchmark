FROM ubuntu:22.04

# Minimal prompt-only image (no GUI). Creates a non-root user and drops into bash.
ARG USERNAME=vscode
ARG USER_UID=1000
ARG USER_GID=1000

RUN groupadd --gid ${USER_GID} ${USERNAME} \
 && useradd -s /bin/bash --uid ${USER_UID} --gid ${USER_GID} -m ${USERNAME}

COPY run-agent.sh /usr/local/bin/run-agent
RUN chmod +x /usr/local/bin/run-agent

USER ${USERNAME}
WORKDIR /home/${USERNAME}

# Entrypoint script accepts -p/--prompt and executes $AGENT_CMD with $PROMPT available
ENTRYPOINT ["/usr/local/bin/run-agent"]
CMD ["/bin/bash"]